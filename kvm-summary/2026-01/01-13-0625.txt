From 384dda62a to add82e97b
KVM mailing list update from 384dda62a to add82e97b

Top 15 contributor Email domains (Based on Email Body)

     19 redhat.com
      6 google.com
      4 tu-dortmund.de
      4 linux.dev

Top 15 contributors (Based on Email Body)

     19  Ani Sinha <anisinha@redhat.com>
      6  Kevin Cheng <chengkev@google.com>
      4  Yosry Ahmed <yosry.ahmed@linux.dev>
      4  Simon Schippers <simon.schippers@tu-dortmund.de>

===== Patch list in this time period =====


===== Patch Commit Messages ====

New:  nSVM: Minor cleanups for intercepts code
[PATCH 0/3] nSVM: Minor cleanups for intercepts code
Author: Yosry Ahmed <yosry.ahmed@linux.dev>

A few minor cleanups for nested intercepts code, namely making
recalc_intercepts() more readable and renaming it, and using
vmcb12_is_intercept() instead of open-coding it.

Yosry Ahmed (3):
  KVM: nSVM: Use intuitive local variables in recalc_intercepts()
  KVM: nSVM: Rename recalc_intercepts() to clarify vmcb02 as the target
  KVM: nSVM: Use vmcb12_is_intercept() in
    nested_sync_control_from_vmcb02()

 arch/x86/kvm/svm/nested.c | 37 ++++++++++++++++++-------------------
 arch/x86/kvm/svm/sev.c    |  2 +-
 arch/x86/kvm/svm/svm.c    |  4 ++--
 arch/x86/kvm/svm/svm.h    | 10 +++++-----
 4 files changed, 26 insertions(+), 27 deletions(-)

----------------------------------------------------------------------

New:  KVM: nSVM: Use intuitive local variables in recalc_intercepts()
[PATCH 1/3] KVM: nSVM: Use intuitive local variables in recalc_intercepts()
Author: Yosry Ahmed <yosry.ahmed@linux.dev>

recalc_intercepts() currently uses c, h, g as local variables for the
control area of the current VMCB, vmcb01, and (cached) vmcb12.

The current VMCB should always be vmcb02 when recalc_intercepts() is
executed in guest mode. Use vmcb01/vmcb02 local variables instead to
make it clear the function is updating intercepts in vmcb02 based on the
intercepts in vmcb01 and (cached) vmcb12.

Add a WARNING() if the current VMCB is not in fact vmcb02.

No functional change intended.

Signed-off-by: Yosry Ahmed <yosry.ahmed@linux.dev>
---
 arch/x86/kvm/svm/nested.c | 31 +++++++++++++++----------------
 1 file changed, 15 insertions(+), 16 deletions(-)

----------------------------------------------------------------------

New:  KVM: SVM: Move STGI and CLGI intercept handling
[PATCH V2 1/5] KVM: SVM: Move STGI and CLGI intercept handling
Author: Kevin Cheng <chengkev@google.com>

Similar to VMLOAD/VMSAVE intercept handling, move the STGI/CLGI
intercept handling to svm_recalc_instruction_intercepts().
---
 arch/x86/kvm/svm/svm.c | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

----------------------------------------------------------------------

New:  Align SVM with APM defined behaviors
[PATCH V2 0/5] Align SVM with APM defined behaviors
Author: Kevin Cheng <chengkev@google.com>

The APM lists the following behaviors
  - The VMRUN, VMLOAD, VMSAVE, CLGI, VMMCALL, and INVLPGA instructions
    can be used when the EFER.SVME is set to 1; otherwise, these
    instructions generate a #UD exception.
  - If VMMCALL instruction is not intercepted, the instruction raises a
    #UD exception.
  - STGI instruction causes a #UD exception if SVM is not enabled and
    neither SVM Lock nor the device exclusion vector (DEV) are
    supported.

The patches in this series fix current SVM bugs that do not adhere to
the APM listed behaviors.

v1 -> v2:
  - Split up the series into smaller more logical changes as suggested
    by Sean
  - Added patch for injecting #UD for STGI under APM defined conditions
    as suggested by Sean
  - Combined EFER.SVME=0 conditional with intel CPU logic in
    svm_recalc_instruction_intercepts

v1: https://lore.kernel.org/all/20260106041250.2125920-1-chengkev@google.com/

Kevin Cheng (5):
  KVM: SVM: Move STGI and CLGI intercept handling
  KVM: SVM: Inject #UD for STGI if EFER.SVME=0 and SVM Lock and DEV are
    not available
  KVM: SVM: Inject #UD for INVLPGA if EFER.SVME=0
  KVM: SVM: Recalc instructions intercepts when EFER.SVME is toggled
  KVM: SVM: Raise #UD if VMMCALL instruction is not intercepted

 arch/x86/kvm/svm/svm.c | 52 ++++++++++++++++++++++++++++++++++++------
 1 file changed, 45 insertions(+), 7 deletions(-)

----------------------------------------------------------------------

New:  i386/kvm: avoid installing duplicate msr entries in msr_handlers
[PATCH v2 01/32] i386/kvm: avoid installing duplicate msr entries in msr_handlers
Author: Ani Sinha <anisinha@redhat.com>

kvm_filter_msr() does not check if an msr entry is already present in the
msr_handlers table and installs a new handler unconditionally. If the function
is called again with the same MSR, it will result in duplicate entries in the
table and multiple such calls will fill up the table needlessly. Fix that.

Signed-off-by: Ani Sinha <anisinha@redhat.com>
---
 target/i386/kvm/kvm.c | 26 ++++++++++++++++----------
 1 file changed, 16 insertions(+), 10 deletions(-)

----------------------------------------------------------------------

