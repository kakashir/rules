From 926d99911 to 702801e9b
KVM mailing list update from 926d99911 to 702801e9b

Top 15 contributor Email domains (Based on Email Body)

      4 gmail.com
      3 linux.alibaba.com
      2 thorondor.fr
      1 aosc.io

Top 15 contributors (Based on Email Body)

      4  Jiakai Xu <jiakaipeanut@gmail.com>
      3  Fangyu Yu <fangyu.yu@linux.alibaba.com>
      2  Thomas Courrege <thomas.courrege@thorondor.fr>
      1  Zixing Liu <liushuyu@aosc.io>

===== Patch list in this time period =====


===== Patch Commit Messages ====

New:  RISC-V: KVM: Support runtime configuration for per-VM's HGATP mode
[PATCH v3 1/2] RISC-V: KVM: Support runtime configuration for per-VM's HGATP mode
Author: fangyu.yu <fangyu.yu@linux.alibaba.com>


Introduces one per-VM architecture-specific fields to support runtime
configuration of the G-stage page table format:

- kvm->arch.kvm_riscv_gstage_pgd_levels: the corresponding number of page
  table levels for the selected mode.

These fields replace the previous global variables
kvm_riscv_gstage_mode and kvm_riscv_gstage_pgd_levels, enabling different
virtual machines to independently select their G-stage page table format
instead of being forced to share the maximum mode detected by the kernel
at boot time.

Signed-off-by: Fangyu Yu <fangyu.yu@linux.alibaba.com>
---
 arch/riscv/include/asm/kvm_gstage.h | 11 ++---
 arch/riscv/include/asm/kvm_host.h   | 19 +++++++
 arch/riscv/kvm/gstage.c             | 77 ++++++++++++++++-------------
 arch/riscv/kvm/main.c               | 12 ++---
 arch/riscv/kvm/mmu.c                | 23 ++++++---
 arch/riscv/kvm/vm.c                 |  2 +-
 arch/riscv/kvm/vmid.c               |  3 +-
 7 files changed, 90 insertions(+), 57 deletions(-)

----------------------------------------------------------------------

Exist: [PATCH v3 1/2] RISC-V: KVM: Support runtime configuration for per-VM's HGATP mode
 Skip: [PATCH v3 0/2] Support runtime configuration for per-VM's HGATP mode
New:  KVM: SEV: Add KVM_SEV_SNP_HV_REPORT_REQ command
[PATCH v5 0/1] KVM: SEV: Add KVM_SEV_SNP_HV_REPORT_REQ command
Author: Thomas Courrege <thomas.courrege@thorondor.fr>

For testing this via QEMU, please use the following tree:
        https://github.com/Th0rOnDoR/qemu

Any feedback is appreciated.

Thanks,
Thomas

Patch History
==============

v4 -> v5:
Set variables in reverse christmas tree order
Fix and clean the rsp_size logic

v3 -> v4:
Add newline in documentation to avoid a warning
Add base commit

v2 -> v3:
Add padding to structure, code format
Write back the full MSG_REPORT_RSP structure
Remove the memzero_explicit for the report

v1 -> v2:
Renaming, code format
Zeroes the report before returning


Thomas Courrege (1):
  KVM: SEV: Add KVM_SEV_SNP_HV_REPORT_REQ command

 .../virt/kvm/x86/amd-memory-encryption.rst    | 29 +++++++++
 arch/x86/include/uapi/asm/kvm.h               |  9 +++
 arch/x86/kvm/svm/sev.c                        | 62 +++++++++++++++++++
 drivers/crypto/ccp/sev-dev.c                  |  1 +
 include/linux/psp-sev.h                       | 31 ++++++++++
 5 files changed, 132 insertions(+)

----------------------------------------------------------------------

New:  RISC-V: KVM: Fix null pointer dereference in kvm_riscv_aia_imsic_has_attr
[PATCH] RISC-V: KVM: Fix null pointer dereference in kvm_riscv_aia_imsic_has_attr
Author: Jiakai Xu <jiakaipeanut@gmail.com>

Add a null pointer check for imsic_state before dereferencing it in
kvm_riscv_aia_imsic_has_attr(). While the function checks that the
vcpu exists, it doesn't verify that the vcpu's imsic_state has been
initialized, leading to a null pointer dereference when accessed.

This issue was discovered during fuzzing of RISC-V KVM code. The
crash occurs when userspace calls KVM_HAS_DEVICE_ATTR ioctl on an
AIA IMSIC device before the IMSIC state has been fully initialized
for a vcpu.

The crash manifests as:
  Unable to handle kernel paging request at virtual address 
  dfffffff00000001
  ...
  epc : kvm_riscv_aia_imsic_has_attr+0x464/0x50e 
  arch/riscv/kvm/aia_imsic.c:998
  ...
  kvm_riscv_aia_imsic_has_attr+0x464/0x50e arch/riscv/kvm/aia_imsic.c:998
  aia_has_attr+0x128/0x2bc arch/riscv/kvm/aia_device.c:471
  kvm_device_ioctl_attr virt/kvm/kvm_main.c:4722 [inline]
  kvm_device_ioctl+0x296/0x374 virt/kvm/kvm_main.c:4739
  ...

The fix adds a check to return -ENODEV if imsic_state is NULL, which
is consistent with other error handling in the function and prevents
the null pointer dereference.

Reproducer and detailed analysis available at:
https://github.com/j1akai/temp/tree/main/20260125

Signed-off-by: Jiakai Xu <xujiakai2025@iscas.ac.cn>
---
 arch/riscv/kvm/aia_imsic.c | 3 +++
 1 file changed, 3 insertions(+)

----------------------------------------------------------------------

New:  KVM: Add KVM_GET_REG_LIST ioctl for LoongArch
[PATCH 1/1] KVM: Add KVM_GET_REG_LIST ioctl for LoongArch
Author: Zixing Liu <liushuyu@aosc.io>

This ioctl can be used by userspace applications to determine which
(special) registers are get/set-able.

This can be very useful for cross-platform VMMs so that they do not have
to hardcode register indices for each supported architectures.

Signed-off-by: Zixing Liu <liushuyu@aosc.io>
---

For example, this ioctl could be used by rust-vmm/rust-kvm or maybe
VirtualBox-kvm in the future.

 Documentation/virt/kvm/api.rst |  2 +-
 arch/loongarch/kvm/vcpu.c      | 69 ++++++++++++++++++++++++++++++++++
 2 files changed, 70 insertions(+), 1 deletion(-)

----------------------------------------------------------------------

