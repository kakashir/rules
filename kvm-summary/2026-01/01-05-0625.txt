From 0f444bb80 to 0b15536c0
KVM mailing list update from 0f444bb80 to 0b15536c0

Top 15 contributor Email domains (Based on Email Body)

      5 huawei.com
      4 gmail.com
      1 bytedance.com
      1 0x65c.net

Top 15 contributors (Based on Email Body)

      4  Naohiko Shimizu <naohiko.shimizu@gmail.com>
      4  Longfang Liu <liulongfang@huawei.com>
      1  Xu Lu <luxu.kernel@bytedance.com>
      1  Weili Qian <qianweili@huawei.com>
      1  Alessandro Ratti <alessandro@0x65c.net>

===== Patch list in this time period =====


===== Patch Commit Messages ====

New:  riscv: clocksource: Fix stimecmp update hazard on RV32
[PATCH v3 1/3] riscv: clocksource: Fix stimecmp update hazard on RV32
Author: Naohiko Shimizu <naohiko.shimizu@gmail.com>

On RV32, updating the 64-bit stimecmp (or vstimecmp) CSR requires two
separate 32-bit writes. A race condition exists if the timer triggers
during these two writes.

The RISC-V Privileged Specification (e.g., Section 3.2.1 for mtimecmp)
recommends a specific 3-step sequence to avoid spurious interrupts
when updating 64-bit comparison registers on 32-bit systems:

1. Set the low-order bits (stimecmp) to all ones (ULONG_MAX).
2. Set the high-order bits (stimecmph) to the desired value.
3. Set the low-order bits (stimecmp) to the desired value.

Current implementation writes the LSB first without ensuring a future
value, which may lead to a transient state where the 64-bit comparison
is incorrectly evaluated as "expired" by the hardware. This results in
spurious timer interrupts.

This patch adopts the spec-recommended 3-step sequence to ensure the
intermediate 64-bit state is never smaller than the current time.

Fixes: 9f7a8ff6391f ("RISC-V: Prefer sstc extension if available")
Signed-off-by: Naohiko Shimizu <naohiko.shimizu@gmail.com>
---
 drivers/clocksource/timer-riscv.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

----------------------------------------------------------------------

New:  riscv: fix timer update hazards on RV32
[PATCH v3 0/3] riscv: fix timer update hazards on RV32
Author: Naohiko Shimizu <naohiko.shimizu@gmail.com>

This patch series fixes timer register update hazards on RV32 for
clocksource, KVM, and suspend/resume paths by adopting the 3-step
update sequence recommended by the RISC-V Privileged Specification.

Changes in v3:
- Dropped redundant subject line from commit descriptions.
- Added Fixes tags for all patches.
- Moved Signed-off-by tags to the end of commit messages.

Changes in v2:
- Added detailed architectural background to commit messages.
- Added KVM and suspend/resume cases.

Naohiko Shimizu (3):
  riscv: clocksource: Fix stimecmp update hazard on RV32
  riscv: kvm: Fix vstimecmp update hazard on RV32
  riscv: suspend: Fix stimecmp update hazard on RV32

 arch/riscv/kernel/suspend.c       | 3 ++-
 arch/riscv/kvm/vcpu_timer.c       | 6 ++++--
 drivers/clocksource/timer-riscv.c | 3 ++-
 3 files changed, 8 insertions(+), 4 deletions(-)

----------------------------------------------------------------------

New:  hisi_acc_vfio_pci: fix VF reset timeout issue
[PATCH 1/4] hisi_acc_vfio_pci: fix VF reset timeout issue
Author: Longfang Liu <liulongfang@huawei.com>


If device error occurs during live migration, qemu will
reset the VF. At this time, VF reset and device reset are performed
simultaneously. The VF reset will timeout. Therefore, the QM_RESETTING
flag is used to ensure that VF reset and device reset are performed
serially.

Fixes: b0eed085903e ("hisi_acc_vfio_pci: Add support for VFIO live migration")
Signed-off-by: Weili Qian <qianweili@huawei.com>
---
 .../vfio/pci/hisilicon/hisi_acc_vfio_pci.c    | 24 +++++++++++++++++++
 .../vfio/pci/hisilicon/hisi_acc_vfio_pci.h    |  2 ++
 2 files changed, 26 insertions(+)

----------------------------------------------------------------------

New:  bugfix some issues under abnormal scenarios. 
[PATCH 0/4] bugfix some issues under abnormal scenarios. 
Author: Longfang Liu <liulongfang@huawei.com>

In certain reset scenarios, repeated migration scenarios, and error injection
scenarios, it is essential to ensure that the device driver functions properly.
Issues arising in these scenarios need to be addressed and fixed

Longfang Liu (3):
  hisi_acc_vfio_pci: update status after RAS error
  hisi_acc_vfio_pci: resolve duplicate migration states
  hisi_acc_vfio_pci: fix the queue parameter anomaly issue

Weili Qian (1):
  hisi_acc_vfio_pci: fix VF reset timeout issue

 .../vfio/pci/hisilicon/hisi_acc_vfio_pci.c    | 40 +++++++++++++++----
 .../vfio/pci/hisilicon/hisi_acc_vfio_pci.h    |  2 +
 2 files changed, 34 insertions(+), 8 deletions(-)

----------------------------------------------------------------------

