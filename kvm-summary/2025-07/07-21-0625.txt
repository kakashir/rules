From 5c464ce74 to 8bf8366cc
KVM mailing list update from 5c464ce74 to 8bf8366cc

Top 15 contributor Email domains (Based on Email Body)

      2 kernel.org
      1 gmail.com

Top 15 contributors (Based on Email Body)

      2  Marc Zyngier <maz@kernel.org>
      1  Yury Norov <yury.norov@gmail.com>

===== Patch list in this time period =====


===== Patch Commit Messages ====

New:  KVM: arm64: Filter out HCR_EL2.VSE when running in hypervisor context
[PATCH] KVM: arm64: Filter out HCR_EL2.VSE when running in hypervisor context
Author: Marc Zyngier <maz@kernel.org>

HCR_EL2.VSE is delivering a virtual SError to the guest, and does not
affect EL2 itself. However, when computing the host's HCR_EL2 value,
we take the guest's view of HCR_EL2.VSE at face value, and apply it
irrespective of the guest's exception level we are returning to.

The result is that a L1 hypervisor injecting a virtual SError to an L2
by setting its HCR_EL2.VSE to 1 results in itself getting the SError
as if it was a physical one if it traps for any reason before returning
to L2.

Fix it by filtering HCR_EL2.VSE out when entering the L1 host context.

Fixes: 04ab519bb86df ("KVM: arm64: nv: Configure HCR_EL2 for FEAT_NV2")
Signed-off-by: Marc Zyngier <maz@kernel.org>
Cc: stable@vger.kernel.org
---
 arch/arm64/kvm/hyp/vhe/switch.c | 3 +++
 1 file changed, 3 insertions(+)

----------------------------------------------------------------------

New:  KVM: arm64: Check for SYSREGS_ON_CPU before accessing the CPU state
[PATCH] KVM: arm64: Check for SYSREGS_ON_CPU before accessing the CPU state
Author: Marc Zyngier <maz@kernel.org>

Mark Brown reports that since we commit to making exceptions
visible without the vcpu being loaded, the external abort selftest
fails.

Upon investigation, it turns out that the code that makes registers
affected by an exception visible to the guest is completely broken
on VHE, as we don't check whether the system registers are loaded
on the CPU at this point. We managed to get away with this so far,
but that's obviously as bad as it gets,

Add the required checksm and document the absolute need to check
for the SYSREGS_ON_CPU flag before calling into any of the
__vcpu_write_sys_reg_to_cpu()__vcpu_read_sys_reg_from_cpu() helpers.

Reported-by: Mark Brown <broonie@kernel.org>
Signed-off-by: Marc Zyngier <maz@kernel.org>
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/18535df8-e647-4643-af9a-bb780af03a70@sirena.org.uk
---
 arch/arm64/include/asm/kvm_host.h | 4 ++++
 arch/arm64/kvm/hyp/exception.c    | 6 ++++--
 2 files changed, 8 insertions(+), 2 deletions(-)

----------------------------------------------------------------------

New:  kvm: x86: simplify kvm_vector_to_index()
[PATCH] kvm: x86: simplify kvm_vector_to_index()
Author: Yury Norov <yury.norov@gmail.com>

Use find_nth_bit() and make the function almost a one-liner.

Signed-off-by: Yury Norov <yury.norov@gmail.com>
---
 arch/x86/kvm/lapic.c | 12 +++---------
 1 file changed, 3 insertions(+), 9 deletions(-)

----------------------------------------------------------------------

